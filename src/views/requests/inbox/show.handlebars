{{#section "title"}}
  <title>受信リクエスト詳細</title>
{{/section}}
{{#section "css"}}
  <link rel="stylesheet" href="/public/css/request-show.css">
{{/section}}
{{#section "js"}}
  <script src="/public/js/confirm.js"></script>
{{/section}}

<section class="tl-section">
  <div class="page-title">
    <h1>{{title}}</h1>
    <a class="back-btn" href="/companies/{{companyId}}/requests/inbox">← 受信一覧へ</a>
  </div>

  <div class="tl-card">
    <div class="tl-card__header">案件</div>

    <div class="form-group">
      <label class="tl-label">案件名</label>
      <div class="form-preview" style="white-space:normal">{{request.request_title}}</div>
    </div>

    <div class="form-group">
      <label class="tl-label">案件詳細</label>
      <pre class="form-preview">{{request.message_text}}</pre>
    </div>

    <!-- ステータス（バッジ表示） -->
    <div class="form-group">
      <label class="tl-label">ステータス</label>
      <div class="form-preview status-row">
        {{#if (eq request.status "pending")}}
          <span class="status-badge is-pending">承認待ち</span>
        {{else if (eq request.status "accepted")}}
          <span class="status-badge is-accepted">承諾</span>
        {{else if (eq request.status "declined")}}
          <span class="status-badge is-declined">辞退</span>
        {{else if (eq request.status "expired")}}
          <span class="status-badge is-expired">取り下げ</span>
        {{else}}
          <span class="status-badge">{{request.status}}</span>
        {{/if}}
      </div>
    </div>

    <!-- 承諾済みなら送信者メール（mailtoリンク） -->
    {{#if (eq request.status "accepted")}}
      <div class="form-group">
        <label class="tl-label">送信者メールアドレス</label>
        <div class="form-preview mail-row">
          {{#if request.sender_email}}
            <a class="mail-link" href="mailto:{{request.sender_email}}">{{request.sender_email}}</a>
          {{else}}
            （メールは取得されていません）
          {{/if}}
        </div>
      </div>
    {{/if}}

    {{#if (eq request.status "pending")}}
      <form method="post" action="/companies/{{companyId}}/requests/inbox/{{request.id}}/respond" class="form-actions" style="margin-top: 8px;">
        <input type="hidden" name="_csrf" value="{{csrfToken}}">
        <button type="submit" class="btn-ghost" name="action" value="declined" data-confirm="このリクエストを辞退します。よろしいですか？">辞退する</button>
        <button type="submit" class="btn-primary" name="action" value="accepted" data-confirm="このリクエストを承諾します。よろしいですか？" style="margin-left: 8px;">承諾する</button>
      </form>
    {{/if}}

    <div class="form-actions" style="margin-top: 8px;">
      <a class="btn-ghost" href="/companies/{{companyId}}/requests/inbox">← 受信一覧へ</a>
    </div>
  </div>
</section>
